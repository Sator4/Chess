Класс board - это массив 8*8 из элементов класса cell
Класс cell добавлен просто чтобы был, вместо недо можно было бы написать структуру
В начале вызывается констуктор и создаются доска и история ходов - массив из структур {string, cell.status} - ход и то, какая фигура была взята
Сразу после создания вызывается метод resetboard, расставляющий фигуры по местам и сбрасывающий счётчики
Команды вводятся в бесконечном цикле: команда хода - строка четырёх букв (рокировку можно вводить как 0-0-0/0-0, так и как ход короля), reset/new game, back и exit
exit заканчивает бесконечный цикл
back вызывает метод reverse, возвращающий всё на ход назад
reset или new game запускает resetboard
Остальные команды расцениваются как ходы
Ход - метод move, тут строка разбирается на координаты, вызывается legal_move, проверяющий на то, чтобы фигуры не атаковали своих, соблюдали очередность хода, ходили туда, куда могли и не встречали по пути другие фигуры
Если походила ладья или король, это записывается в a1h1e1a8h8e8
Если король походил на две клетки в бок, между ним и ладьёй не стоят фигуры и в a1h1e1a8h8e8 стоят true, происходит рокировка
В историю записывается ход, ход совершается, ведется поиск королей, вызывается метод under_attack по их координатам, и если он возвращает true, вызывается reverse
Если пешка достигла последней горизонтали, её можно превратить в другую фигуру
Запускается метод show, который выводит доску